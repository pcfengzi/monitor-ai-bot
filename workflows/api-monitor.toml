[[workflows]]
name = "s2c_login"
enabled = true
interval_secs = 60          # 每 60 秒探测一次
base_url = "https://xxxxx.xxxxx.com"

  [[workflows.steps]]
  id = "login"
  method = "POST"
  path = "/s2c/login_user"

  body = '{"username": "{{USER}}", "password": "{{PASS}}", "grant_type": "password"}'

  [workflows.steps.headers]
  Content-Type = "application/json"

  [workflows.steps.extract]
  token   = "access_token"
  user_id = "user.id"

  # 断言 1：HTTP 状态码 == 200
  [[workflows.steps.asserts]]
  status = 200

  # 断言 2：业务 code == "200"（注意要加引号）
  [[workflows.steps.asserts]]
  json_path = "code"
  equals = "200"

  # 断言 3：邮箱匹配（可选）
  [[workflows.steps.asserts]]
  json_path = "user.email"
  equals = "{{USER}}"

  # 断言 4：user.id 匹配（可选）
  [[workflows.steps.asserts]]
  json_path = "user.id"
  equals = "{{EXPECTED_USER_ID}}"


[[workflows]]
name = "s2c_get_user"
enabled = true
interval_secs = 120        # 每 2 分钟探测一次
base_url = "https://xxxxx.xxxxx.com"

  [[workflows.steps]]
  id = "get_user"
  method = "POST"
  path = "/s2c/get_user_info"

  body = '{"token":"{{token}}"}'   # 如果需要 token，可以用上一个登录 workflow 的 extract

  [workflows.steps.headers]
  Content-Type = "application/json"

  [workflows.steps.extract]
  token   = "access_token"
  user_id = "user.id"

  [[workflows.steps.asserts]]
  status = 200

  [[workflows.steps.asserts]]
  json_path = "code"
  equals = "200"

